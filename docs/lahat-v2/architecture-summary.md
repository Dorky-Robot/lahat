# Lahat v2 Architecture Summary

## Overview

Lahat v2 is a modular application that enables users to create, manage, and run mini desktop applications through natural language prompts. The architecture has been redesigned to separate concerns into three distinct modules:

1. **app-creator**: Handles the creation of new applications through natural language prompts
2. **app-list**: Manages the listing and selection of created applications
3. **app-manager**: Loads and runs the web components generated by the app-creator

## Module Independence

Each module in Lahat v2 is fully self-contained with no shared code between modules. This approach reduces cognitive load and allows modules to evolve independently.

### App Creator Module Components

The App Creator module contains all components needed for app creation:

- Step-based creation workflow
- Claude API integration
- App generation logic
- Preview functionality

### App List Module Components

The App List module contains all components needed for app listing and selection:

- App listing and filtering
- Navigation controls
- App selection
- Settings management

### App Manager Module Components

The App Manager module contains all components needed for app management and execution:

- LahatCells for hosting web components
- Module-specific EventBus for component communication
- Widget management
- Layout management

## Module Architecture

### App Creator Module

The App Creator module is responsible for generating web components based on user prompts. It provides a guided interface for users to describe the application they want to create and uses Claude to generate the necessary code.

Key features:
- Natural language prompt interface
- Step-by-step creation process
- Preview of generated code
- Integration with Claude API

### App List Module

The App List module serves as the main entry point to the Lahat application. It displays a list of available mini apps and provides navigation controls to access other parts of the application.

Key features:
- Display a list of available mini apps
- Navigation controls (Mini Apps, Create, Settings)
- App selection and launching
- App filtering and sorting

### App Manager Module

The App Manager module is responsible for loading, displaying, and managing the web components generated by the App Creator. It provides a container environment where these components can run safely and communicate with each other through a controlled event system.

Key features:
- Loading and displaying generated web components
- Managing the lifecycle of components
- Providing a secure execution environment
- Facilitating communication between components
- Widget management and organization

## Communication Architecture

The communication architecture in Lahat v2 has two distinct layers:

### Inter-Process Communication (IPC)

For communication between modules and between the main process and renderer processes:

1. Uses Electron's contextBridge for secure IPC
2. Implements preload scripts for each module
3. Provides a secure API for module-to-module communication

Benefits:
- **Security**: contextBridge provides a secure way to expose APIs
- **Isolation**: Modules run in separate processes
- **Stability**: Process crashes are isolated and don't affect other modules

### Client-Side Event Bus

For communication between components within a renderer process:

1. Components publish events to the EventBus
2. The EventBus routes events to subscribers
3. CustomEvent proxies filter events based on security policies
4. Subscribers receive and process the events

Benefits:
- **Loose Coupling**: Components don't need to know about each other
- **Scalability**: New components can be added without modifying existing ones
- **Testability**: Components can be tested in isolation
- **Security**: Event filtering prevents unauthorized access

## Security Architecture

The security architecture in Lahat v2 is designed to provide a secure environment for running user-generated code:

1. **Isolation**: LahatCells provide isolation boundaries for web components
2. **Content Security Policy**: Web components are loaded with strict CSP settings
3. **Event Filtering**: CustomEvent proxies filter events based on security policies
4. **Input Validation**: All inputs are validated before being processed

## Deployment Architecture

Lahat v2 is designed to be deployed as an Electron application:

1. **Main Process**: Handles system-level operations
2. **Renderer Process**: Renders the UI and runs the web components
3. **IPC Communication**: Enables communication between the main and renderer processes

## Migration Path

The migration from Lahat v1 to v2 will follow an incremental approach:

1. **Project Setup and IPC Infrastructure**: Set up the project structure and implement IPC communication
2. **App List Module**: Implement the app list module with its own independent components
3. **App Creator Module**: Implement the app creator module with its own independent components
4. **App Manager Module**: Implement the app manager module with its own independent components
5. **Integration**: Connect all modules through IPC using Electron's contextBridge

## Future Extensibility

The modular architecture of Lahat v2 is designed to be extensible:

1. **New Modules**: Additional modules can be added without modifying existing ones
2. **Plugin System**: A plugin system can be implemented to allow third-party extensions
3. **API Integration**: Integration with external APIs can be added through new modules
4. **Custom Widgets**: Users can create and share custom widgets
