# Lahat v2 Architecture Overview

## Introduction

Lahat v2 is a modular application that enables users to create, manage, and run mini desktop applications through natural language prompts. The architecture has been redesigned to separate concerns into three distinct modules:

1. **app-creator**: Handles the creation of new applications through natural language prompts
2. **app-list**: Manages the listing and selection of created applications
3. **app-manager**: Loads and runs the web components generated by the app-creator

## System Architecture

The system architecture follows a modular design with complete module independence and clear separation of concerns:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│   app-creator   │◄───▶│    app-list     │◄───▶│   app-manager   │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        ▲                       ▲                       ▲
        │                       │                       │
        ▼                       ▼                       ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │
│  IPC Interface  │     │  IPC Interface  │     │  IPC Interface  │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### Module Independence

Each module is fully self-contained with no shared code between modules:

1. **app-creator**: Contains all components needed for app creation
2. **app-list**: Contains all components needed for app listing and selection
3. **app-manager**: Contains all components needed for app management and execution

### Key Module-Specific Components

#### App Creator Components
- Step-based creation workflow
- Claude API integration
- App generation logic

#### App List Components
- App listing and filtering
- Navigation controls
- App selection

#### App Manager Components
- LahatCells for hosting web components
- Module-specific EventBus for component communication
- Widget management

#### Generated WebComponents
These are the actual mini applications created through the app-creator. They are loaded into the App Manager's LahatCells.

## Module Interactions

1. **app-creator** generates web components based on user prompts
2. **app-list** displays the available applications and allows users to select them
3. **app-manager** loads the selected applications into LahatCells and manages their lifecycle

## Communication Architecture

The communication architecture in Lahat v2 has two distinct layers:

1. **Inter-Process Communication (IPC)**:
   - Uses Electron's contextBridge for communication between modules
   - Handles communication between main process and renderer processes
   - Manages module-to-module communication

2. **Client-Side Event Bus**:
   - Used within the renderer process for LahatCells and web components
   - Implements a micro frontend event bus pattern
   - Handles communication between components through CustomEvents

## Data Flow

1. User selects "Create" from the app-list view
2. The app-creator opens and guides the user through creating a new application (using IPC via contextBridge)
3. Once created, the new application appears in the app-list
4. When selected, the application is loaded by the app-manager into LahatCells
5. Within the app-manager, components communicate through the EventBus using custom events

## Security Model

The application implements a secure architecture where:

1. Generated components run in isolated LahatCells
2. Communication between components is controlled through the EventBus
3. Event proxies ensure that only permitted events are propagated

## Next Steps

For more detailed information about each module, refer to:

- [App Creator Module](./app-creator-module.md)
- [App List Module](./app-list-module.md)
- [App Manager Module](./app-manager-module.md)
- [Event System](./event-system.md)
- [Component Lifecycle](./component-lifecycle.md)
